<!-- Bottom Sheet para ver/copiar el enlace -->
<div id="sheet" class="fixed inset-0 z-[60] hidden">
  <div class="absolute inset-0 bg-black/60" onclick="hideSheet()"></div>
  <div class="absolute inset-x-0 bottom-0 bg-[#0b1220] border-t border-white/10 rounded-t-2xl p-4 space-y-3">
    <div class="flex items-center justify-between">
      <h4 class="text-lg font-semibold">Enlace afiliado</h4>
      <button class="chip px-3 py-1.5 rounded-xl" onclick="hideSheet()">Cerrar</button>
    </div>
    <textarea id="sheetUrl" class="field w-full rounded-xl p-3 text-sm" rows="3" readonly></textarea>
    <div class="grid grid-cols-2 gap-2">
      <button class="btn-grad rounded-xl py-2 font-semibold" onclick="copyFromSheet()">Copiar</button>
      <button class="chip rounded-xl py-2 font-semibold" onclick="shareFromSheet()">Compartir</button>
    </div>
  </div>
</div>
<script>
  function showSheet(url){ document.getElementById('sheetUrl').value=url; document.getElementById('sheet').classList.remove('hidden'); }
  function hideSheet(){ document.getElementById('sheet').classList.add('hidden'); }
  async function copyFromSheet(){ await navigator.clipboard.writeText(document.getElementById('sheetUrl').value); alert('Enlace copiado ✅'); }
  async function shareFromSheet(){
    const url = document.getElementById('sheetUrl').value;
    if (navigator.share) { try { await navigator.share({ title:'Producto Amazon', url }); } catch(_){} }
    else { await navigator.clipboard.writeText(url); alert('Enlace copiado ✅'); }
  }
</script>
<script>
function cardHTML(p){
  const price = p.price? new Intl.NumberFormat('es', {style:'currency', currency:'USD'}).format(p.price):'';
  const url = p.amazon;
  return `
  <div class="rounded-2xl overflow-hidden card flex flex-col product" data-url="${url}">
    <div class="relative">
      <img src="${p.image}" alt="${p.title}" class="w-full h-44 object-cover" loading="lazy">
      <span class="absolute top-2 left-2 badge px-2 py-0.5 rounded text-[10px]">${p.category||'Otros'}</span>
    </div>
    <div class="p-4 flex-1 flex flex-col">
      <h3 class="font-semibold leading-tight">${p.title}</h3>
      <div class="text-sm text-white/70 mt-1">${price||''}</div>
      <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-2">
        <a target="_blank" href="${url}" class="btn-grad text-center text-white font-semibold py-2 rounded-xl">Ver en Amazon</a>
        <button class="copy px-3 py-2 rounded-xl chip font-semibold">Copiar</button>
        <button class="share px-3 py-2 rounded-xl chip font-semibold">Compartir</button>
      </div>
      <div class="mt-2 grid grid-cols-2 gap-2">
        <button data-id="${p.id||''}" class="edit px-3 py-2 rounded-xl chip">Editar</button>
        <button data-id="${p.id||''}" class="del px-3 py-2 rounded-xl chip">Borrar</button>
      </div>
    </div>
  </div>`;
}
</script>
